<div class="sections-container">
  <button type="button" class="back-btn" (click)="goBack()">Back</button>

  <div class="sections-list">
    @for (section of sectionsWithNews; track section.sectionId) {
    <div class="section-bubble">
      <h2>{{ sectionName.formatSectionName(section.sectionName) }}</h2>

      @if (section.news.length > 0) {
      @for (source of section.groupedNews; track source.key) {
      <div class="source-container">
        <div class="source-bubble" (click)="toggleSource(section.sectionId, source)">
          <span class="domain">{{ sectionName.getDomain(source.key) }}</span>
          <span class="count-news">{{ source.unread.length }}</span>
        </div>

        @if (source.isOpen) {
        <ul class="dropdown-news" (click)="$event.stopPropagation()">
          @if (source.unread.length > 0) {
          <li class="section-divider">Unreaded</li>
          @for (item of source.unread; track item.id) {
          <li class="news-item unread" (click)="toggleNewsItem(source, item)">
            <div class="news-header">
              <span class="news-title">
                {{ item.title }}
                <span class="unread-dot"></span>
              </span>
              <span class="news-date">{{ item.publishedAt | date: 'short' }}</span>
            </div>
            @if (source.openItemId === item.id) {
            <p class="news-content">{{ item.summary }}</p>
            <a [href]="item.link" target="_blank" (click)="onArticleLinkClick($event, item, true)">Read full article here</a>
            }
          </li>
          }
          }

          <li class="divider"></li>

          @if (source.read.length > 0) {
          <li class="section-divider">Readed</li>
          @for (item of source.read; track item.id) {
          <li class="news-item read" (click)="toggleNewsItem(source, item)">
            <div class="news-header">
              <span class="news-title">{{ item.title }}</span>
              <span class="news-date">{{ item.publishedAt | date: 'short' }}</span>
            </div>
            @if (source.openItemId === item.id) {
            <p class="news-content">{{ item.summary }}</p>
            <a [href]="item.link" target="_blank" (click)="onArticleLinkClick($event, item, true)">Read full article here</a>
            }
          </li>
          }
          }
        </ul>
        }
      </div>
      }
      } @else {
      <p>No news available in this section.</p>
      }
    </div>
    }
  </div>
</div>